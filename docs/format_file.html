---

title: format_file


keywords: fastai
sidebar: home_sidebar

summary: "Functions to format a SQL file with multiple queries and SQL statements"
description: "Functions to format a SQL file with multiple queries and SQL statements"
nb_path: "nbs/01_format_file.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_format_file.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">module_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="k">if</span> <span class="n">module_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Use-Case">Use-Case<a class="anchor-link" href="#Use-Case"> </a></h2><p>Assume you have a file called sql_file.py containing SQL statements and queries.</p>
<p>After reading it in python we could have something like this:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sql_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- Views for some nice data mart ---</span>
<span class="s2">use database my_database;</span>
<span class="s2">use schema my_schema;</span>

<span class="s2">create or replace view first_view as -- my first view</span>
<span class="s2">select a.car_id,</span>
<span class="s2">       b.car_name, sum(a.price) over (partition by b.car_name order by a.car_id) as sum_price, a.price,</span>
<span class="s2">from sales as a left join (select car_id, car_name, from cars) as b </span>
<span class="s2">on a.car_id = b.car_id</span>
<span class="s2">where car_id&gt;1 and car_id&lt;=100 order by b.car_name;</span>

<span class="s2">-- Table no. 1 --</span>
<span class="s2">create or replace table first_table as -- my first table</span>
<span class="s2">select car_id,</span>
<span class="s2">       avg(price) as avg_price,</span>
<span class="s2">from first_view</span>
<span class="s2">group by car_id order by car_id;</span>

<span class="s2">--- End of file ---</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we would like to format the SQL-queries in this file, while letting every other non-query-SQL statement untouched. For the example above we would like to have something like this:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_sql_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- Views for some nice data mart ---</span>
<span class="s2">use database my_database;</span>
<span class="s2">use schema my_schema;</span>


<span class="s2">CREATE OR REPLACE VIEW first_view AS -- my first view</span>
<span class="s2">SELECT a.car_id,</span>
<span class="s2">    b.car_name,</span>
<span class="s2">    sum(a.price) OVER (</span>
<span class="s2">        PARTITION BY b.car_name</span>
<span class="s2">        ORDER BY a.car_id</span>
<span class="s2">    ) AS sum_price,</span>
<span class="s2">    a.price</span>
<span class="s2">FROM sales AS a</span>
<span class="s2">    LEFT JOIN (</span>
<span class="s2">        SELECT car_id,</span>
<span class="s2">            car_name</span>
<span class="s2">        FROM cars</span>
<span class="s2">    ) AS b</span>
<span class="s2">        ON a.car_id = b.car_id</span>
<span class="s2">WHERE car_id &gt; 1</span>
<span class="s2">    AND car_id &lt;= 100</span>
<span class="s2">ORDER BY b.car_name;</span>


<span class="s2">-- Table no. 1 --</span>
<span class="s2">CREATE OR REPLACE TABLE first_table AS</span>
<span class="s2">SELECT car_id,</span>
<span class="s2">    avg(price) AS avg_price -- my first table</span>
<span class="s2">FROM first_view</span>
<span class="s2">GROUP BY car_id</span>
<span class="s2">ORDER BY car_id;</span>

<span class="s2">--- End of file ---</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>python file
test_script.py</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Formatting-philosophy-of-SQL-files">Formatting philosophy of SQL files<a class="anchor-link" href="#Formatting-philosophy-of-SQL-files"> </a></h3><ul>
<li>Every SQL-query is separated from above by two new lines</li>
<li>Every SQL-query is formatted via <a href="/ptypysql/core.html#format_sql"><code>format_sql</code></a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Main-function-to-format-the-SQL-commands-in-a-file">Main function to format the SQL commands in a file<a class="anchor-link" href="#Main-function-to-format-the-SQL-commands-in-a-file"> </a></h3><p>This function applies also basic validation and aborts formatting if the statements <code>CREATE .. TABLE / VIEW</code> appear at least twice in the same query after splitting by semicolon, warning the user that she / he may have forgotten a semicolon</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_sql_commands" class="doc_header"><code>format_sql_commands</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/format_file.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_sql_commands</code>(<strong><code>s</code></strong>, <strong><code>max_len</code></strong>=<em><code>99</code></em>, <strong><code>semicolon</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Format SQL commands in <code>s</code>. If SELECT line is longer than <code>max_len</code> then reformat line</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Basic file formatting</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql_commands</span><span class="p">(</span><span class="n">sql_file</span><span class="p">),</span>
    <span class="n">expected_sql_file</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>--- Views for some nice data mart ---
use database my_database;
use schema my_schema;


CREATE OR REPLACE VIEW first_view AS -- my first view
SELECT a.car_id,
    b.car_name,
    sum(a.price) OVER (
        PARTITION BY b.car_name
        ORDER BY a.car_id
    ) AS sum_price,
    a.price
FROM sales AS a
    LEFT JOIN (
        SELECT car_id,
            car_name
        FROM cars
    ) AS b
        ON a.car_id = b.car_id
WHERE car_id &gt; 1
    AND car_id &lt;= 100
ORDER BY b.car_name;


-- Table no. 1 --
CREATE OR REPLACE TABLE first_table AS
SELECT car_id,
    avg(price) AS avg_price -- my first table
FROM first_view
GROUP BY car_id
ORDER BY car_id;

--- End of file ---

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using the <code>/*skip-formatter*/</code> marker to not format some query</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql_commands</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">use database my_database;</span>

<span class="s2">/*skip-formatter*/</span>
<span class="s2">create Or replace View my_view aS</span>
<span class="s2">select asdf, qwer</span>
<span class="s2">from table1;</span>

<span class="s2">create or replace table my_table As</span>
<span class="s2">Select asdf, qwer</span>
<span class="s2">From table2</span>
<span class="s2">group by asdf;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;use database my_database;</span>

<span class="sd">/*skip-formatter*/</span>
<span class="sd">create Or replace View my_view aS</span>
<span class="sd">select asdf, qwer</span>
<span class="sd">from table1;</span>


<span class="sd">CREATE OR REPLACE TABLE my_table AS</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">    qwer</span>
<span class="sd">FROM table2</span>
<span class="sd">GROUP BY asdf;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>use database my_database;

/*skip-formatter*/
create Or replace View my_view aS
select asdf, qwer
from table1;


CREATE OR REPLACE TABLE my_table AS
SELECT asdf,
    qwer
FROM table2
GROUP BY asdf;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql_commands</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace table my_table As</span>
<span class="s2">Select asdf, qwer</span>
<span class="s2">From table2</span>
<span class="s2">group by asdf;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE my_table AS</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">    qwer</span>
<span class="sd">FROM table2</span>
<span class="sd">GROUP BY asdf;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE my_table AS
SELECT asdf,
    qwer
FROM table2
GROUP BY asdf;

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># assert_and_print(</span>
<span class="c1">#     format_sql_commands(&quot;&quot;&quot;</span>
<span class="c1"># create or replace table my_table As</span>
<span class="c1"># Select asdf, qwer</span>
<span class="c1"># From table2</span>
<span class="c1"># group by asdf -- some comment</span>
<span class="c1"># ;</span>
<span class="c1"># &quot;&quot;&quot;),</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1"># CREATE OR REPLACE TABLE my_table AS </span>
<span class="c1"># SELECT asdf,</span>
<span class="c1">#     qwer</span>
<span class="c1"># FROM table2</span>
<span class="c1"># GROUP BY asdf; -- some comment</span>
<span class="c1"># &quot;&quot;&quot;.lstrip())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># assert_and_print(</span>
<span class="c1">#     format_sql_commands(</span>
<span class="c1"># &quot;&quot;&quot;</span>
<span class="c1"># create table my_table As</span>
<span class="c1"># select asdf, Qwer, /* ; */</span>
<span class="c1"># qwer2, -- ;</span>
<span class="c1"># replace(&#39;;&#39;, &#39;&#39;, qwer3) as Qwer4</span>
<span class="c1"># from table1; /* Some comment */</span>

<span class="c1"># create view my_view As</span>
<span class="c1"># Select asdf</span>
<span class="c1"># From my_table; /* Another comment */</span>
<span class="c1"># &quot;&quot;&quot;</span>
<span class="c1">#     ),</span>
<span class="c1"># &quot;&quot;&quot;</span>
<span class="c1"># CREATE TABLE my_table AS</span>
<span class="c1"># SELECT asdf,</span>
<span class="c1">#        qwer, /* ; */</span>
<span class="c1">#        qwer2, -- ;</span>
<span class="c1">#        replace(&#39;;&#39;, &#39;&#39;, qwer3) AS qwer4</span>
<span class="c1"># FROM   table1; /* Some comment */</span>


<span class="c1"># CREATE VIEW my_view AS</span>
<span class="c1"># SELECT asdf</span>
<span class="c1"># FROM   my_table; /* Another comment */</span>
<span class="c1"># &quot;&quot;&quot;.lstrip()</span>
<span class="c1"># )</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># assert_and_print(</span>
<span class="c1">#     format_sql_commands(</span>
<span class="c1"># &quot;&quot;&quot;</span>
<span class="c1"># create or replace transient table my_table As</span>
<span class="c1"># select asdf, Qwer, /* ; */</span>
<span class="c1"># qwer2, -- ;</span>
<span class="c1"># replace(&#39;;&#39;, &#39;&#39;, qwer3) as Qwer4</span>
<span class="c1"># from table1;</span>

<span class="c1"># create view my_view As</span>
<span class="c1"># Select asdf</span>
<span class="c1"># From my_table;</span>
<span class="c1"># &quot;&quot;&quot;.lstrip()</span>
<span class="c1">#     ),</span>
<span class="c1"># &quot;&quot;&quot;</span>
<span class="c1"># CREATE OR REPLACE TRANSIENT TABLE my_table AS</span>
<span class="c1"># SELECT asdf,</span>
<span class="c1">#        qwer, /* ; */</span>
<span class="c1">#        qwer2, -- ;</span>
<span class="c1">#        replace(&#39;;&#39;, &#39;&#39;, qwer3) AS qwer4</span>
<span class="c1"># FROM   table1;</span>


<span class="c1"># CREATE VIEW my_view AS</span>
<span class="c1"># SELECT asdf</span>
<span class="c1"># FROM   my_table;</span>
<span class="c1"># &quot;&quot;&quot;.lstrip()</span>
<span class="c1"># )</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If the validation fails, then the function returns a dictionary instead of the formatted queries with information about the error</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Semicolon validation error</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql_commands</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace transient table my_table As</span>
<span class="sd">select asdf, Qwer, /* ; */</span>
<span class="sd">qwer2, -- ;</span>
<span class="sd">replace(&#39;;&#39;, &#39;&#39;, qwer3) as Qwer4</span>
<span class="sd">from table1</span>

<span class="sd">create view my_view As</span>
<span class="sd">Select asdf</span>
<span class="sd">From my_table;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="p">),</span> 
    <span class="p">{</span><span class="s2">&quot;semicolon&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]}}</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;semicolon&#39;: {&#39;error_code&#39;: 2, &#39;lines&#39;: [(1, 7)]}}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unbalanced parenthesis error</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql_commands</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace transient table my_table As</span>
<span class="sd">select asdf, Qwer, /* ; */</span>
<span class="sd">(qwer2, -- ; ()</span>
<span class="sd">( /* ) */</span>
<span class="sd">replace(&#39;;&#39;, &#39;&#39;, qwer3) as Qwer4</span>
<span class="sd">from table1;</span>

<span class="sd">create view my_view As</span>
<span class="sd">(Select asdf</span>
<span class="sd">From my_table;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="p">),</span> 
    <span class="p">{</span><span class="s2">&quot;unbalanced_parenthesis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">]]}}</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;unbalanced_parenthesis&#39;: {&#39;error_code&#39;: 3, &#39;lines&#39;: [[3, 4], [9]]}}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unbalanced parenthesis + semicolon error</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql_commands</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace transient table my_table As</span>
<span class="sd">select asdf, Qwer, /* ; */</span>
<span class="sd">(qwer2, -- ; ()</span>
<span class="sd">( /* ) */</span>
<span class="sd">replace(&#39;;&#39;, &#39;&#39;, qwer3) as Qwer4</span>
<span class="sd">from table1</span>

<span class="sd">create view my_view As</span>
<span class="sd">(Select asdf</span>
<span class="sd">From my_table;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="p">),</span> 
    <span class="p">{</span>
        <span class="s2">&quot;semicolon&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]},</span>        
        <span class="s2">&quot;unbalanced_parenthesis&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]},</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;semicolon&#39;: {&#39;error_code&#39;: 2, &#39;lines&#39;: [(1, 8)]}, &#39;unbalanced_parenthesis&#39;: {&#39;error_code&#39;: 3, &#39;lines&#39;: [[3, 4, 9]]}}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unbalanced case when ... end</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql_commands</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace transient table my_table As</span>
<span class="sd">select asdf, Qwer, /* ; */</span>
<span class="sd">case when asdf = 1 then 1 as qwer,</span>
<span class="sd">replace(&#39;;&#39;, &#39;&#39;, qwer3) as Qwer4</span>
<span class="sd">from table1;</span>

<span class="sd">create view my_view As</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="p">),</span> 
    <span class="p">{</span><span class="s2">&quot;unbalanced_case&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error_code&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">3</span><span class="p">]]}}</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;unbalanced_case&#39;: {&#39;error_code&#39;: 4, &#39;lines&#39;: [[3]]}}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Function-to-format-1-SQL-file">Function to format 1 SQL file<a class="anchor-link" href="#Function-to-format-1-SQL-file"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_sql_file" class="doc_header"><code>format_sql_file</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/format_file.py#L104" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_sql_file</code>(<strong><code>f</code></strong>, <strong><code>max_len</code></strong>=<em><code>99</code></em>)</p>
</blockquote>
<p>Format file <code>f</code> with SQL commands and overwrite the file.
If SELECT line is longer than 82 characters then reformat line</p>
<p>Return exit_code:</p>
<ul>
<li>0 = Everything already formatted</li>
<li>1 = Formatting applied</li>
<li>2 = Problem detected, formatting aborted</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Function-to-format-many-SQL-files">Function to format many SQL files<a class="anchor-link" href="#Function-to-format-many-SQL-files"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_sql_files" class="doc_header"><code>format_sql_files</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/format_file.py#L196" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_sql_files</code>(<strong><code>files</code></strong>, <strong><code>recursive</code></strong>=<em><code>False</code></em>, <strong><code>max_len</code></strong>=<em><code>99</code></em>)</p>
</blockquote>
<p>Format SQL <code>files</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_sql_files_cli" class="doc_header"><code>format_sql_files_cli</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/format_file.py#L213" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_sql_files_cli</code>()</p>
</blockquote>
<p>Format SQL files</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>


