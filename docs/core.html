---

title: core


keywords: fastai
sidebar: home_sidebar

summary: "Core functions for SQL formatting"
description: "Core functions for SQL formatting"
nb_path: "nbs/00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">module_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="k">if</span> <span class="n">module_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="General-formatting">General formatting<a class="anchor-link" href="#General-formatting"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Basic formatting for SQL queries. Let's use an example throughout the core module.</p>
<p>This is how an input could look like</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace table mytable as -- Mytable example</span>
<span class="s2">/* multi line</span>
<span class="s2">   comment */</span>
<span class="s2">seLecT a.asdf,</span>
<span class="s2">-- some line comment</span>
<span class="s2">b.qwer, -- some comment here</span>
<span class="s2">/* and here is a line comment inside select */</span>
<span class="s2">substr(c.asdf,1,2) as substr_asdf, </span>
<span class="s2">/* some commenT </span>
<span class="s2">there */</span>
<span class="s2">case when a.asdf= 1 then &#39;b&#39; /* here a case comment */</span>
<span class="s2">when b.qwer =2 then &#39;c&#39; else &#39;d&#39; end as new_field, -- Some comment</span>
<span class="s2">/* and here some inline comment */</span>
<span class="s2">b.asdf2 frOm table1 as a leFt join </span>
<span class="s2">table2 as b -- and here a comment</span>
<span class="s2">    on a.asdf = b.asdf  /* joiN this way */</span>
<span class="s2">    inner join table3 as c</span>
<span class="s2">on a.asdf=c.asdf and a.qwer= b.qwer</span>
<span class="s2">whEre a.asdf= 1 -- comment this</span>
<span class="s2">anD b.qwer =2 and a.asdf&lt;=1 --comment that</span>
<span class="s2">or b.qwer&gt;=5</span>
<span class="s2">groUp by a.asdf</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and this is how we would like to format it</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CREATE OR REPLACE TABLE mytable AS -- Mytable example</span>
<span class="s2">/* multi line</span>
<span class="s2">   comment */</span>
<span class="s2">SELECT a.asdf,</span>
<span class="s2">    -- some line comment</span>
<span class="s2">    b.qwer, -- some comment here</span>
<span class="s2">    /* and here is a line comment inside select */</span>
<span class="s2">    substr(c.asdf, 1, 2) AS substr_asdf,</span>
<span class="s2">    /* some commenT</span>
<span class="s2">       there */</span>
<span class="s2">    CASE WHEN a.asdf = 1</span>
<span class="s2">        THEN &#39;b&#39; /* here a case comment */</span>
<span class="s2">        WHEN b.qwer = 2</span>
<span class="s2">        THEN &#39;c&#39;</span>
<span class="s2">        ELSE &#39;d&#39;</span>
<span class="s2">    END AS new_field, -- Some comment</span>
<span class="s2">    /* and here some inline comment */</span>
<span class="s2">    b.asdf2</span>
<span class="s2">FROM table1 AS a</span>
<span class="s2">    LEFT JOIN table2 AS b -- and here a comment</span>
<span class="s2">        ON a.asdf = b.asdf /* joiN this way */</span>
<span class="s2">    INNER JOIN table3 AS c</span>
<span class="s2">        ON a.asdf = c.asdf</span>
<span class="s2">        AND a.qwer = b.qwer</span>
<span class="s2">WHERE a.asdf = 1 -- comment this</span>
<span class="s2">    AND b.qwer = 2</span>
<span class="s2">    AND a.asdf &lt;= 1 --comment that</span>
<span class="s2">    OR b.qwer &gt;= 5</span>
<span class="s2">GROUP BY a.asdf&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's start by defining the main statements. The main statements all require a new line and should be in upper case</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Remark:For OVER and PARTITION BY we only capitalize without adding a newline</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to remove newlines and multiple spaces because they may be arbitrary.</p>
<p>Before removing newlines we also need to mark the end of coments with the special token [C] because we would not know where they end</p>
<p>We also mark the begin of comments /<em> </em>/ with the special token [CS] (comment start) if they start in a newline</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_query" class="doc_header"><code>clean_query</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L100" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_query</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Remove redundant whitespaces, mark comments boundaries and remove newlines afterwards in query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf, qwer,</span>
<span class="sd"> qwer1,    qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, qwer1, qwer2 FROM table1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, qwer1, qwer2 FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With usual comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf, qwer, -- some comment</span>
<span class="s2"> qwer1,    qwer2</span>
<span class="s2">FROM table1</span>
<span class="s2">WHERE asdf=1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, -- some comment[C]qwer1, qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, -- some comment[C]qwer1, qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With other comment form</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf, qwer, /*  another comment */</span>
<span class="s2">qwer1,    qwer2</span>
<span class="s2">FROM table1</span>
<span class="s2">WHERE asdf=1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span> <span class="s2">&quot;SELECT asdf, qwer, /* another comment */[C]qwer1, qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, /* another comment */[C]qwer1, qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf, qwer, /*  another comment */</span>
<span class="sd">qwer1,</span>
<span class="sd">/* inline comment */</span>
<span class="sd">qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">WHERE asdf=1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> 
    <span class="s2">&quot;SELECT asdf, qwer, /* another comment */[C]qwer1,[CS]/* inline comment */[C]qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer, /* another comment */[C]qwer1,[CS]/* inline comment */[C]qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">qwer1, -- comment 1</span>
<span class="sd">-- inline comment</span>
<span class="sd">qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">WHERE asdf=1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> 
    <span class="s2">&quot;SELECT asdf, qwer1, -- comment 1[C][CS]-- inline comment[C]qwer2 FROM table1 WHERE asdf=1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer1, -- comment 1[C][CS]-- inline comment[C]qwer2 FROM table1 WHERE asdf=1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace my_table as</span>
<span class="sd">/* some comment</span>
<span class="sd">   some new comment line */</span>
<span class="sd">select asdf,</span>
<span class="sd">qwer,   qwer2</span>

<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="s2">&quot;create or replace my_table as[CS]/* some comment[CI]some new comment line */[C]select asdf, qwer, qwer2 from table1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>create or replace my_table as[CS]/* some comment[CI]some new comment line */[C]select asdf, qwer, qwer2 from table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">clean_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table my_table as</span>
<span class="sd">select substr( asdf, 1, 2 ) as qwer,</span>
<span class="sd">qwer over (</span>
<span class="sd">PARTITION BY asdf</span>
<span class="sd">)</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;create or replace table my_table as select substr(asdf, 1, 2) as qwer, qwer over (PARTITION BY asdf) from table1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>create or replace table my_table as select substr(asdf, 1, 2) as qwer, qwer over (PARTITION BY asdf) from table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">clean_query</span><span class="p">(</span><span class="n">example_sql</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>create or replace table mytable as -- Mytable example[C][CS]/* multi line[CI]comment */[C]seLecT a.asdf,[CS]-- some line comment[C]b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) as substr_asdf,[CS]/* some commenT[CI]there */[C]case when a.asdf= 1 then &#39;b&#39; /* here a case comment */[C]when b.qwer =2 then &#39;c&#39; else &#39;d&#39; end as new_field, -- Some comment[C][CS]/* and here some inline comment */[C]b.asdf2 frOm table1 as a leFt join table2 as b -- and here a comment[C]on a.asdf = b.asdf /* joiN this way */[C]inner join table3 as c on a.asdf=c.asdf and a.qwer= b.qwer whEre a.asdf= 1 -- comment this[C]anD b.qwer =2 and a.asdf&lt;=1 --comment that[C]or b.qwer&gt;=5 groUp by a.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Preformatting-queries">Preformatting queries<a class="anchor-link" href="#Preformatting-queries"> </a></h3><p>We would like to have each main statement (SELECT, FROM , ...) in a separate line and in uppercase, ignoring text in comments. This way we can then later format each query statement separately. Also for the special case with PARTITION BY in the SELECT statement we will not add a newline because the main statement in that case is SELECT and not PARTITION BY</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="preformat_statements" class="doc_header"><code>preformat_statements</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L113" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>preformat_statements</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Write a newline in <code>s</code> for all <code>statements</code> and
uppercase them but not if they are inside a comment</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer as new_var from table1 where asdf = 1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;SELECT asdf, qwer AS new_var</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, qwer AS new_var
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">seLect asdf,</span>
<span class="s2">       /* some comment inside select */</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="s2">&quot;SELECT asdf,[CS]/* some comment inside select */[C]qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,[CS]/* some comment inside select */[C]qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">seLect asdf, /* some comment inside select */</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="s2">&quot;SELECT asdf, /* some comment inside select */[C]qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf, /* some comment inside select */[C]qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace view my_view as</span>
<span class="s2">seLect asdf,</span>
<span class="s2">       /* some comment inside select */</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="s2">&quot;CREATE OR REPLACE VIEW my_view AS</span><span class="se">\n</span><span class="s2">SELECT asdf,[CS]/* some comment inside select */[C]qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE VIEW my_view AS
SELECT asdf,[CS]/* some comment inside select */[C]qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace view my_view as</span>
<span class="s2">seLect asdf,</span>
<span class="s2">       qwer_function,</span>
<span class="s2">       qwer</span>
<span class="s2">From   table1 where  asdf = 1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="s2">&quot;CREATE OR REPLACE VIEW my_view AS</span><span class="se">\n</span><span class="s2">SELECT asdf, qwer_function, qwer</span><span class="se">\n</span><span class="s2">FROM table1</span><span class="se">\n</span><span class="s2">WHERE asdf = 1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE VIEW my_view AS
SELECT asdf, qwer_function, qwer
FROM table1
WHERE asdf = 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace view my_view as</span>
<span class="s2">seLect asdf, qwer_function,</span>
<span class="s2">       lead(asdf) over (Partition By asdf order BY qwer),</span>
<span class="s2">    qwer2</span>
<span class="s2">From   table1 where  asdf = 1 order by asdf</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE VIEW my_view AS</span>
<span class="sd">SELECT asdf, qwer_function, lead(asdf) OVER (PARTITION BY asdf ORDER BY qwer), qwer2</span>
<span class="sd">FROM table1</span>
<span class="sd">WHERE asdf = 1</span>
<span class="sd">ORDER BY asdf</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE VIEW my_view AS
SELECT asdf, qwer_function, lead(asdf) OVER (PARTITION BY asdf ORDER BY qwer), qwer2
FROM table1
WHERE asdf = 1
ORDER BY asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table mytable as -- Mytable example</span>
<span class="sd">seLecT a.asdf, b.qwer, -- some comment here</span>
<span class="sd">/* and here is a line comment inside select */</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE mytable AS -- Mytable example[C]</span>
<span class="sd">SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) AS substr_asdf</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE mytable AS -- Mytable example[C]
SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) AS substr_asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create table mytable as -- Mytable example</span>
<span class="sd">seLecT a.asdf, b.qwer, -- some comment here</span>
<span class="sd">/* and here is a line comment inside select */</span>
<span class="sd">substr(c.asdf, 1, 2) as substr_asdf</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE TABLE mytable AS -- Mytable example[C]</span>
<span class="sd">SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) AS substr_asdf</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE TABLE mytable AS -- Mytable example[C]
SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) AS substr_asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table  my_table as -- mytable</span>
<span class="sd">select distinct asdf, qwer, -- some comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE my_table AS -- mytable[C]</span>
<span class="sd">SELECT DISTINCT asdf, qwer, -- some comment[C]</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE my_table AS -- mytable[C]
SELECT DISTINCT asdf, qwer, -- some comment[C]
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With additional keyword <code>COMMENT</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table  my_table comment=&#39;blabla&#39; as -- mytable</span>
<span class="sd">select distinct asdf, qwer, -- some comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE my_table comment=&#39;blabla&#39; AS -- mytable[C]</span>
<span class="sd">SELECT DISTINCT asdf, qwer, -- some comment[C]</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE my_table comment=&#39;blabla&#39; AS -- mytable[C]
SELECT DISTINCT asdf, qwer, -- some comment[C]
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace transient table  my_table as -- mytable</span>
<span class="sd">select distinct asdf, qwer, -- some comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TRANSIENT TABLE my_table AS -- mytable[C]</span>
<span class="sd">SELECT DISTINCT asdf, qwer, -- some comment[C]</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TRANSIENT TABLE my_table AS -- mytable[C]
SELECT DISTINCT asdf, qwer, -- some comment[C]
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">preformat_statements</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Create view  my_table as -- mytable</span>
<span class="sd">select distinct asdf, qwer, -- some comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE VIEW my_table AS -- mytable[C]</span>
<span class="sd">SELECT DISTINCT asdf, qwer, -- some comment[C]</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE VIEW my_table AS -- mytable[C]
SELECT DISTINCT asdf, qwer, -- some comment[C]
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">preformat_statements</span><span class="p">(</span><span class="n">example_sql</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE mytable AS -- Mytable example[C][CS]/* multi line[CI]comment */[C]
SELECT a.asdf,[CS]-- some line comment[C]b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]substr(c.asdf, 1, 2) AS substr_asdf,[CS]/* some commenT[CI]there */[C]CASE WHEN a.asdf= 1 THEN &#39;b&#39; /* here a case comment */[C]WHEN b.qwer =2 THEN &#39;c&#39; ELSE &#39;d&#39; END AS new_field, -- Some comment[C][CS]/* and here some inline comment */[C]b.asdf2
FROM table1 AS a
LEFT JOIN table2 AS b -- and here a comment[C]
ON a.asdf = b.asdf /* joiN this way */[C]
INNER JOIN table3 AS c
ON a.asdf=c.asdf AND a.qwer= b.qwer
WHERE a.asdf= 1 -- comment this[C]AND b.qwer =2 AND a.asdf&lt;=1 --comment that[C]OR b.qwer&gt;=5
GROUP BY a.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Lowercasing-query">Lowercasing query<a class="anchor-link" href="#Lowercasing-query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lowercase_query" class="doc_header"><code>lowercase_query</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L166" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lowercase_query</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Lowercase query but let comments and text in quotes untouched</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">--- My nice view 1 --</span>
<span class="s2">Create or Replace VieW view_1 as</span>
<span class="s2">seLect asdf, -- Some Comment</span>
<span class="s2">qwER,</span>
<span class="s2">qwerTy, -- Some other comment</span>
<span class="s2">FROM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">--- My nice view 1 --</span>
<span class="sd">create or replace view view_1 as</span>
<span class="sd">select asdf, -- Some Comment</span>
<span class="sd">qwer,</span>
<span class="sd">qwerty, -- Some other comment</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
--- My nice view 1 --
create or replace view view_1 as
select asdf, -- Some Comment
qwer,
qwerty, -- Some other comment
from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- Some comment --</span>
<span class="s2">Create Or rePlace tablE aS</span>
<span class="s2">sElEct asdf,</span>
<span class="s2">/* sOme CommEnt */</span>
<span class="s2">qwer</span>
<span class="s2">FroM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">-- Some comment --</span>
<span class="sd">create or replace table as</span>
<span class="sd">select asdf,</span>
<span class="sd">/* sOme CommEnt */</span>
<span class="sd">qwer</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
-- Some comment --
create or replace table as
select asdf,
/* sOme CommEnt */
qwer
from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- Some comment --</span>
<span class="s2">Create Or rePlace tablE aS</span>
<span class="s2">sElEct asdf, replace(&#39;J&#39;, &#39;N&#39;, Asdf2) as Asdf3</span>
<span class="s2">/* sOme CommEnt */</span>
<span class="s2">qwer</span>
<span class="s2">FroM table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">-- Some comment --</span>
<span class="sd">create or replace table as</span>
<span class="sd">select asdf, replace(&#39;J&#39;, &#39;N&#39;, asdf2) as asdf3</span>
<span class="sd">/* sOme CommEnt */</span>
<span class="sd">qwer</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
-- Some comment --
create or replace table as
select asdf, replace(&#39;J&#39;, &#39;N&#39;, asdf2) as asdf3
/* sOme CommEnt */
qwer
from table1

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">lowercase_query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-- Some comment --</span>
<span class="s2">Create Or rePlace tablE aS</span>
<span class="s2">sElEct asdf, replace(&#39;J&#39;, &#39;N&#39;, Asdf2) as Asdf3</span>
<span class="s2">/* sOme CommEnt */</span>
<span class="s2">qwer</span>
<span class="s2">FroM table1 -- Some comment</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">-- Some comment --</span>
<span class="sd">create or replace table as</span>
<span class="sd">select asdf, replace(&#39;J&#39;, &#39;N&#39;, asdf2) as asdf3</span>
<span class="sd">/* sOme CommEnt */</span>
<span class="sd">qwer</span>
<span class="sd">from table1 -- Some comment</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
-- Some comment --
create or replace table as
select asdf, replace(&#39;J&#39;, &#39;N&#39;, asdf2) as asdf3
/* sOme CommEnt */
qwer
from table1 -- Some comment

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Add-whitespaces-between-symbols">Add whitespaces between symbols<a class="anchor-link" href="#Add-whitespaces-between-symbols"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_whitespaces_query" class="doc_header"><code>add_whitespaces_query</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L179" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_whitespaces_query</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Add whitespaces between symbols (=!&lt;&gt;) for query <code>s</code> but not for comments</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_whitespaces_query</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table my_table as /* some comment 1=1, 1 =1 */</span>
<span class="sd">select asdf, case when asdf= 1 then &#39;=&#39; else 0 end as qwerty</span>
<span class="sd">from table1 as a</span>
<span class="sd">left join table2 as b on a.asdf= b.asdf</span>
<span class="sd">where asdf=1 and qwer =2</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table my_table as /* some comment 1=1, 1 =1 */</span>
<span class="sd">select asdf, case when asdf = 1 then &#39;=&#39; else 0 end as qwerty</span>
<span class="sd">from table1 as a</span>
<span class="sd">left join table2 as b on a.asdf = b.asdf</span>
<span class="sd">where asdf = 1 and qwer = 2</span>
<span class="sd">&quot;&quot;&quot;</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
create or replace table my_table as /* some comment 1=1, 1 =1 */
select asdf, case when asdf = 1 then &#39;=&#39; else 0 end as qwerty
from table1 as a
left join table2 as b on a.asdf = b.asdf
where asdf = 1 and qwer = 2

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Specific-formatting-and-validation">Specific formatting and validation<a class="anchor-link" href="#Specific-formatting-and-validation"> </a></h2><p>Now we will format each statement individually</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="PARTITION-BY">PARTITION BY<a class="anchor-link" href="#PARTITION-BY"> </a></h4><p>Helper function for format PARTITION BY Within SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_partition_by" class="doc_header"><code>format_partition_by</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L189" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_partition_by</code>(<strong><code>s</code></strong>, <strong><code>base_indentation</code></strong>)</p>
</blockquote>
<p>Format PARTITION BY line in SELECT (DISTINCT)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;qwer over (partition by asdf, qwer order by qwerty)&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">format_partition_by</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>qwer over (
    partition by asdf,
        qwer
    order by qwerty)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Remove-(mistake)-comma-at-end-of-SELECT">Remove (mistake) comma at end of SELECT<a class="anchor-link" href="#Remove-(mistake)-comma-at-end-of-SELECT"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="remove_wrong_end_comma" class="doc_header"><code>remove_wrong_end_comma</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L218" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>remove_wrong_end_comma</code>(<strong><code>split_s</code></strong>)</p>
</blockquote>
<p>Remove mistakenly placed commas at the end of SELECT statement using <code>split_s</code> with keys
"string", "comment" and "quote"</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_apply_concat</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer, &quot;</span><span class="p">,</span> <span class="n">remove_wrong_end_comma</span><span class="p">),</span>
    <span class="s2">&quot;select asdf, qwer&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf, qwer
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_apply_concat</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer, -- some comment&quot;</span><span class="p">,</span> <span class="n">remove_wrong_end_comma</span><span class="p">),</span>
    <span class="s2">&quot;select asdf, qwer -- some comment&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf, qwer -- some comment
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_apply_concat</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer, /* another comment */&quot;</span><span class="p">,</span> <span class="n">remove_wrong_end_comma</span><span class="p">),</span>
    <span class="s2">&quot;select asdf, qwer /* another comment */&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf, qwer /* another comment */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">split_apply_concat</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer,,,, /* more than 1 comma */&quot;</span><span class="p">,</span> <span class="n">remove_wrong_end_comma</span><span class="p">),</span>    
    <span class="s2">&quot;select asdf, qwer /* more than 1 comma */&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf, qwer /* more than 1 comma */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Helper-function-for-case-when">Helper function for <code>case when</code><a class="anchor-link" href="#Helper-function-for-case-when"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_case_when" class="doc_header"><code>format_case_when</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L242" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_case_when</code>(<strong><code>s</code></strong>, <strong><code>max_len</code></strong>=<em><code>99</code></em>)</p>
</blockquote>
<p>Format case when statement in line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;def reformat_too_long_line(li, max_len=99):</span>
<span class="sd">    &quot;Reformat too long line `li` if it is longer than `max_len` characters after stripping&quot;</span>
<span class="sd">    if len(li) &gt; max_len and &quot;(&quot; in li[:max_len]:</span>
<span class="sd">        #position of the &quot;(&quot; near to the max_len</span>
<span class="sd">        last_open_parenthesis = max_len - 1 - toolongsql[:max_len][::-1].find(&quot;(&quot;)</span>
<span class="sd">        k = -1</span>
<span class="sd">        last_close_paraenthesis = None</span>
<span class="sd">        for i, c in enumerate(li[last_open_parenthesis:]):</span>
<span class="sd">            if c == &quot;(&quot;: # if there is a parenthesis not involving a subquery</span>
<span class="sd">                k += 1</span>
<span class="sd">            elif c == &quot;)&quot; and k == 0: # end position for subquery</span>
<span class="sd">                last_close_paraenthesis = i</span>
<span class="sd">                print(i)</span>
<span class="sd">                break</span>
<span class="sd">            elif c == &quot;)&quot;:</span>
<span class="sd">                k -= 1</span>
<span class="sd">        </span>
<span class="sd">        # add newline</span>
<span class="sd">        li =  li[:last_open_parenthesis + 1] + &quot;\n&quot; + \</span>
<span class="sd">        li[last_open_parenthesis + 1: last_open_parenthesis + last_close_paraenthesis] + &quot;\n&quot; + \</span>
<span class="sd">        li[last_open_parenthesis + last_close_paraenthesis:]</span>
<span class="sd">        </span>
<span class="sd">        # add indent after each newline</span>
<span class="sd">        li = li.replace(&quot;\n&quot;, &quot;\n&quot; + &quot; &quot; * 4)</span>
<span class="sd">        return li</span>
<span class="sd">    else:</span>
<span class="sd">        return li&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;def reformat_too_long_line(li, max_len=99):\n    &#34;Reformat too long line `li` if it is longer than `max_len` characters after stripping&#34;\n    if len(li) &gt; max_len and &#34;(&#34; in li[:max_len]:\n        #position of the &#34;(&#34; near to the max_len\n        last_open_parenthesis = max_len - 1 - toolongsql[:max_len][::-1].find(&#34;(&#34;)\n        k = -1\n        last_close_paraenthesis = None\n        for i, c in enumerate(li[last_open_parenthesis:]):\n            if c == &#34;(&#34;: # if there is a parenthesis not involving a subquery\n                k += 1\n            elif c == &#34;)&#34; and k == 0: # end position for subquery\n                last_close_paraenthesis = i\n                print(i)\n                break\n            elif c == &#34;)&#34;:\n                k -= 1\n        \n        # add newline\n        li =  li[:last_open_parenthesis + 1] + &#34;\n&#34; +         li[last_open_parenthesis + 1: last_open_parenthesis + last_close_paraenthesis] + &#34;\n&#34; +         li[last_open_parenthesis + last_close_paraenthesis:]\n        \n        # add indent after each newline\n        li = li.replace(&#34;\n&#34;, &#34;\n&#34; + &#34; &#34; * 4)\n        return li\n    else:\n        return li&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Helper-function-to-reformat-too-long-lines-in-SELECT-statement">Helper function to reformat too long lines in SELECT statement<a class="anchor-link" href="#Helper-function-to-reformat-too-long-lines-in-SELECT-statement"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">reformat_too_long_line</span><span class="p">(</span><span class="n">li</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">99</span><span class="p">):</span>
    <span class="s2">&quot;Reformat too long line `li` if it is longer than `max_len` characters after stripping&quot;</span>
    <span class="n">indent_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">li</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">li</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span>
        <span class="n">function_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;[\w\d]+\(&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">function_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">li</span><span class="p">):</span>
            <span class="n">out_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">in_function</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># indicator for reformatting line with function</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># counter for parenthesis</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># indicator for string position</span>
            <span class="n">quote_open1</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># quote &#39;</span>
            <span class="n">quote_open2</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># quote &quot;</span>
            <span class="n">first_append</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">li</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">function_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">in_function</span><span class="p">:</span>
                    <span class="n">in_function</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">indentation</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span> <span class="ow">and</span> <span class="n">in_function</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span> <span class="ow">and</span> <span class="n">in_function</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">in_function</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span> <span class="ow">and</span> <span class="n">in_function</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">first_append</span><span class="p">:</span>
                        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
                        <span class="n">first_append</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>                        
                    <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">quote_open1</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">quote_open1</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">quote_open2</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">quote_open2</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="n">j</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">join_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent_length</span>
                <span class="n">li</span> <span class="o">=</span> <span class="n">join_str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;in (&quot;</span> <span class="ow">in</span> <span class="n">li</span><span class="p">:</span>
            <span class="n">out_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">in_in</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># indicator for string position</span>
            <span class="n">quote_open1</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># quote &#39;</span>
            <span class="n">quote_open2</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># quote &quot;</span>
            <span class="n">first_append</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lcol</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># line code column</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">li</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;in (&quot;</span> <span class="ow">in</span> <span class="n">li</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">in_in</span><span class="p">:</span>
                    <span class="n">in_in</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">indentation</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span> <span class="ow">and</span> <span class="n">in_in</span><span class="p">:</span>
                    <span class="n">in_in</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span> <span class="ow">and</span> <span class="n">in_in</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">line_chunk</span> <span class="o">=</span> <span class="n">li</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">lcol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">+</span> <span class="n">indentation</span>
                    <span class="k">if</span> <span class="n">first_append</span><span class="p">:</span>
                        <span class="n">lcol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>                            
                        <span class="k">if</span> <span class="n">lcol</span> <span class="o">&gt;=</span> <span class="n">max_len</span><span class="p">:</span>
                            <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_chunk</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
                            <span class="n">first_append</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>                            
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lcol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">+</span> <span class="n">indentation</span>
                        <span class="k">if</span> <span class="n">lcol</span> <span class="o">&gt;=</span> <span class="n">max_len</span><span class="p">:</span>
                            <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">quote_open1</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">and</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">quote_open1</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">quote_open2</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote_open1</span> <span class="ow">and</span> <span class="n">quote_open2</span><span class="p">:</span>
                    <span class="n">quote_open2</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="n">j</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">join_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">indent_length</span>
                <span class="n">li</span> <span class="o">=</span> <span class="n">join_str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">li</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">toolongsql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT round(coalesce((coalesce(coalesce(sum(extract(epoch FROM (job.finished_at - job.created_at))) FILTER (WHERE (job.state = &#39;completed&#39;)))) / 60), 0)::numeric, 8) AS time_int&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reformat_too_long_line</span><span class="p">(</span><span class="n">toolongsql</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT round(coalesce((coalesce(coalesce(sum(extract(epoch FROM (job.finished_at - job.created_at))) FILTER (WHERE (job.state = &#39;completed&#39;)))) / 60), 0)::numeric,
    8) AS time_int
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">reformat_too_long_line</span><span class="p">(</span>
        <span class="s2">&quot;select concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2), substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2),</span>
<span class="sd">    substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2),
    substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">reformat_too_long_line</span><span class="p">(</span>
        <span class="s2">&quot;       concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2), substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;       concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2),</span>
<span class="sd">           substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>       concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2),
           substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">reformat_too_long_line</span><span class="p">(</span>
        <span class="s2">&quot;            when concat(&#39;asdf&#39;, &#39;qwer&#39;, &#39;qwerqwerqwerqwerqwerqwerqwr&#39;, substr(concat(&#39;asdf&#39;, &#39;qwer&#39;), 1, 2)) then 2&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;            when concat(&#39;asdf&#39;,</span>
<span class="sd">                &#39;qwer&#39;,</span>
<span class="sd">                &#39;qwerqwerqwerqwerqwerqwerqwr&#39;,</span>
<span class="sd">                substr(concat(&#39;asdf&#39;, &#39;qwer&#39;), 1, 2)) then 2&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>            when concat(&#39;asdf&#39;,
                &#39;qwer&#39;,
                &#39;qwerqwerqwerqwerqwerqwerqwr&#39;,
                substr(concat(&#39;asdf&#39;, &#39;qwer&#39;), 1, 2)) then 2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">reformat_too_long_line</span><span class="p">(</span>
        <span class="s2">&quot;select case when asdf in (1234, 2345, 1234, 2354, 2345, 2352345, 245623462, 124123412, 124312341234) then 1&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select case when asdf in (1234, 2345, 1234, 2354, 2345, 2352345, 245623462, 124123412, 124312341234) then 1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select case when asdf in (1234, 2345, 1234, 2354, 2345, 2352345, 245623462, 124123412, 124312341234) then 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">reformat_too_long_line</span><span class="p">(</span>
        <span class="s2">&quot;select case when asdf in (1234, 2345, 1234, 2354, 2345, 2352345, 245623462, 124123412, 124312341234) then 1&quot;</span><span class="p">,</span>
        <span class="n">max_len</span><span class="o">=</span><span class="mi">40</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select case when asdf in (1234, 2345, 1234,</span>
<span class="sd">    2354, 2345, 2352345,</span>
<span class="sd">    245623462, 124123412,</span>
<span class="sd">    124312341234) then 1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select case when asdf in (1234, 2345, 1234,
    2354, 2345, 2352345,
    245623462, 124123412,
    124312341234) then 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">reformat_too_long_line</span><span class="p">(</span>
        <span class="s2">&quot;select case when asdf in (&#39;1234&#39;, &#39;2345&#39;, &#39;1234&#39;, &#39;2354&#39;, &#39;2345&#39;, &#39;2352345&#39;, &#39;245623462&#39;, &#39;124123412&#39;, &#39;124312341234&#39;) then 1&quot;</span><span class="p">,</span>
        <span class="n">max_len</span><span class="o">=</span><span class="mi">40</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select case when asdf in (&#39;1234&#39;, &#39;2345&#39;,</span>
<span class="sd">    &#39;1234&#39;, &#39;2354&#39;,</span>
<span class="sd">    &#39;2345&#39;, &#39;2352345&#39;,</span>
<span class="sd">    &#39;245623462&#39;, &#39;124123412&#39;,</span>
<span class="sd">    &#39;124312341234&#39;) then 1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select case when asdf in (&#39;1234&#39;, &#39;2345&#39;,
    &#39;1234&#39;, &#39;2354&#39;,
    &#39;2345&#39;, &#39;2352345&#39;,
    &#39;245623462&#39;, &#39;124123412&#39;,
    &#39;124312341234&#39;) then 1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">reformat_too_long_line</span><span class="p">(</span><span class="s2">&quot;select asdf&quot;</span><span class="p">),</span>
<span class="s2">&quot;select asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">reformat_too_long_line</span><span class="p">(</span><span class="s2">&quot;select asdf + asdf1 + asdf2 + asdf3 + asdf4 + asdf5 + asdf6 + asdf7 + asdf8 + asdf9&quot;</span><span class="p">),</span>
<span class="s2">&quot;select asdf + asdf1 + asdf2 + asdf3 + asdf4 + asdf5 + asdf6 + asdf7 + asdf8 + asdf9&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf + asdf1 + asdf2 + asdf3 + asdf4 + asdf5 + asdf6 + asdf7 + asdf8 + asdf9
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SELECT">SELECT<a class="anchor-link" href="#SELECT"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_select" class="doc_header"><code>format_select</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L281" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_select</code>(<strong><code>s</code></strong>, <strong><code>max_len</code></strong>=<em><code>99</code></em>)</p>
</blockquote>
<p>Format SELECT statement line <code>s</code>. If line is longer than <code>max_len</code> then reformat line</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Simple usage without comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select aSdf, cast(qweR as numeric),  Asdf,qwer1&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;select aSdf,</span>
<span class="sd">    cast(qweR as numeric),</span>
<span class="sd">    Asdf,</span>
<span class="sd">    qwer1&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select aSdf,
    cast(qweR as numeric),
    Asdf,
    qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>More advanced usage with comments in SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, cast(qwer as numeric), -- some comment[C]ASDF, qwer1&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;select asdf,</span>
<span class="sd">    cast(qwer as numeric), -- some comment</span>
<span class="sd">    ASDF,</span>
<span class="sd">    qwer1&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    cast(qwer as numeric), -- some comment
    ASDF,
    qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, -- Some comment[C]asdforqwer -- Another comment[C]&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, -- Some comment</span>
<span class="sd">    asdforqwer -- Another comment</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf, -- Some comment
    asdforqwer -- Another comment
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Correcting common mistake on the flow: comma at end of SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1,   asdf,&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1,</span><span class="se">\n</span><span class="s2">    asdf&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;SELECT a.asdf, b.qwer, -- some comment here[C][CS]/* and here is a line comment inside select */[C]qwer2&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT a.asdf,</span>
<span class="sd">    b.qwer, -- some comment here</span>
<span class="sd">    /* and here is a line comment inside select */</span>
<span class="sd">    qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT a.asdf,
    b.qwer, -- some comment here
    /* and here is a line comment inside select */
    qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;SELECT a.asdf,[CS]/* and here is a line comment inside select */&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT a.asdf</span>
<span class="sd">       /* and here is a line comment inside select */</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT a.asdf
       /* and here is a line comment inside select */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Line comment with --</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;SELECT a.asdf, b.qwer, -- some comment here[C][CS]-- and here is a line comment inside select[C]qwer2&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT a.asdf,</span>
<span class="sd">    b.qwer, -- some comment here</span>
<span class="sd">    -- and here is a line comment inside select</span>
<span class="sd">    qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT a.asdf,
    b.qwer, -- some comment here
    -- and here is a line comment inside select
    qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Correcting comma at end of SELECT but having a comment in the last field</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1 as qwer2,   asdf as asdf3, -- this field&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1 as qwer2,</span><span class="se">\n</span><span class="s2">    asdf as asdf3 -- this field&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1 as qwer2,
    asdf as asdf3 -- this field
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1,   asdf, /* this field */&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select qwer1,</span><span class="se">\n</span><span class="s2">    asdf /* this field */&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    asdf /* this field */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <code>case when</code> conditions</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc = 1 then &#39;a&#39; when abc = 2 then &#39;b&#39; else &#39;c&#39; end qwer2&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    case when abc = 1 </span>
<span class="sd">        then &#39;a&#39;</span>
<span class="sd">        when abc = 2 </span>
<span class="sd">        then &#39;b&#39;</span>
<span class="sd">        else &#39;c&#39; </span>
<span class="sd">    end AS qwer2</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    case when abc = 1 
        then &#39;a&#39;
        when abc = 2 
        then &#39;b&#39;
        else &#39;c&#39; 
    end AS qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc = 1 then &#39;a&#39; -- first condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;when abc = 2 then &#39;b&#39; -- second condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;else &#39;c&#39; end as qwer2, /* else condition */[C]&quot;</span>
                  <span class="s2">&quot;asdf3&quot;</span>
<span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    case when abc = 1 </span>
<span class="sd">        then &#39;a&#39; -- first condition</span>
<span class="sd">        when abc = 2 </span>
<span class="sd">        then &#39;b&#39; -- second condition</span>
<span class="sd">        else &#39;c&#39; </span>
<span class="sd">    end as qwer2, /* else condition */</span>
<span class="sd">    asdf3</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    case when abc = 1 
        then &#39;a&#39; -- first condition
        when abc = 2 
        then &#39;b&#39; -- second condition
        else &#39;c&#39; 
    end as qwer2, /* else condition */
    asdf3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Bad formatted <code>case when</code> condition</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc &lt;= 1 then &#39;a&#39; -- first condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;when abc = 2 then &#39;b&#39; -- second condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;else &#39;c&#39; end as qwer2, -- else condition[C]&quot;</span>
                  <span class="s2">&quot;asdf3&quot;</span>
<span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    case when abc &lt;= 1 </span>
<span class="sd">        then &#39;a&#39; -- first condition</span>
<span class="sd">        when abc = 2 </span>
<span class="sd">        then &#39;b&#39; -- second condition</span>
<span class="sd">        else &#39;c&#39; </span>
<span class="sd">    end as qwer2, -- else condition</span>
<span class="sd">    asdf3</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    case when abc &lt;= 1 
        then &#39;a&#39; -- first condition
        when abc = 2 
        then &#39;b&#39; -- second condition
        else &#39;c&#39; 
    end as qwer2, -- else condition
    asdf3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>case when</code> and comment after condition</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when abc &lt;= 1 and -- first condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;abc &gt;= -1 then &#39;a&#39; -- second condition[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;else &#39;c&#39; end as qwer2, -- else condition[C]&quot;</span>
                  <span class="s2">&quot;asdf3&quot;</span>
<span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    case when abc &lt;= 1 and abc &gt;= -1  -- first condition</span>
<span class="sd">        then &#39;a&#39; -- second condition</span>
<span class="sd">        else &#39;c&#39; </span>
<span class="sd">    end as qwer2, -- else condition</span>
<span class="sd">    asdf3</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    case when abc &lt;= 1 and abc &gt;= -1  -- first condition
        then &#39;a&#39; -- second condition
        else &#39;c&#39; 
    end as qwer2, -- else condition
    asdf3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>case when</code> in comments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, case when a3215614834984513155696749788888888888888888888bc &lt;= 1 and -- first condition case when[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;abc &gt;= -1 then &#39;a&#39; -- second condition case when[C]&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot;else &#39;c&#39; end as qwer2, -- else condition[C]&quot;</span>
                  <span class="s2">&quot;asdf3&quot;</span>
<span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    case when a3215614834984513155696749788888888888888888888bc &lt;= 1 and abc &gt;= -1  -- first condition case when</span>
<span class="sd">        then &#39;a&#39; -- second condition case when</span>
<span class="sd">        else &#39;c&#39; </span>
<span class="sd">    end as qwer2, -- else condition</span>
<span class="sd">    asdf3</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    case when a3215614834984513155696749788888888888888888888bc &lt;= 1 and abc &gt;= -1  -- first condition case when
        then &#39;a&#39; -- second condition case when
        else &#39;c&#39; 
    end as qwer2, -- else condition
    asdf3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, case when asdf &gt;= 1 and asdf &lt;= 10 and&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot; substr(qwer, 1, 2) = &#39;abc&#39; and substr(qwer, 3, 2) = &#39;qwerty&#39;&quot;</span> <span class="o">+</span>
                  <span class="s2">&quot; then 1 else 0 end as case_field, asdf2&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    case when asdf &gt;= 1 </span>
<span class="sd">            and asdf &lt;= 10 </span>
<span class="sd">            and substr(qwer, 1, 2) = &#39;abc&#39; </span>
<span class="sd">            and substr(qwer, 3, 2) = &#39;qwerty&#39; </span>
<span class="sd">        then 1</span>
<span class="sd">        else 0 </span>
<span class="sd">    end as case_field,</span>
<span class="sd">    asdf2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    case when asdf &gt;= 1 
            and asdf &lt;= 10 
            and substr(qwer, 1, 2) = &#39;abc&#39; 
            and substr(qwer, 3, 2) = &#39;qwerty&#39; 
        then 1
        else 0 
    end as case_field,
    asdf2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>2 <code>case when ... end</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, cast(case when asdf = 1 then 0 else 1 end as int) as qwer, &quot;</span> <span class="o">+</span>
        <span class="s2">&quot;case when asdf = 0 then 1 else 0 end as qwer2&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    cast(case when asdf = 1 </span>
<span class="sd">        then 0</span>
<span class="sd">        else 1 </span>
<span class="sd">    end as int) as qwer,</span>
<span class="sd">    case when asdf = 0 </span>
<span class="sd">        then 1</span>
<span class="sd">        else 0 </span>
<span class="sd">    end as qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    cast(case when asdf = 1 
        then 0
        else 1 
    end as int) as qwer,
    case when asdf = 0 
        then 1
        else 0 
    end as qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With functions in SELECT</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select aSdf, substr(qweR, 2) as qwer,  Asdf,qwer1&quot;</span><span class="p">),</span>
    <span class="s2">&quot;select aSdf,</span><span class="se">\n</span><span class="s2">    substr(qweR, 2) as qwer,</span><span class="se">\n</span><span class="s2">    Asdf,</span><span class="se">\n</span><span class="s2">    qwer1&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select aSdf,
    substr(qweR, 2) as qwer,
    Asdf,
    qwer1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select car_id,</span>
<span class="sd">       avg(price) as avg_price,</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select car_id,</span>
<span class="sd">    avg(price) as avg_price</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select car_id,
    avg(price) as avg_price
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With function in SELECT and case when</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, cast(case when asdf = &#39;J&#39; then 1 else 0 end) as qwer2, qwer3&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    cast(case when asdf = &#39;J&#39; </span>
<span class="sd">        then 1</span>
<span class="sd">        else 0 </span>
<span class="sd">    end) as qwer2,</span>
<span class="sd">    qwer3</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    cast(case when asdf = &#39;J&#39; 
        then 1
        else 0 
    end) as qwer2,
    qwer3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, cast(substr(case when asdf = &#39;CASE WHEN&#39; then 1 else 0 end, 2, 1)) as qwer2, qwer3&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    cast(substr(case when asdf = &#39;CASE WHEN&#39; </span>
<span class="sd">        then 1</span>
<span class="sd">        else 0 </span>
<span class="sd">    end, 2, 1)) as qwer2,</span>
<span class="sd">    qwer3</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    cast(substr(case when asdf = &#39;CASE WHEN&#39; 
        then 1
        else 0 
    end, 2, 1)) as qwer2,
    qwer3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, substr(qwer, case when asdf = &#39;J&#39; then 1 else 0 end, 4) as qwer2, qwer3&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    substr(qwer, case when asdf = &#39;J&#39; </span>
<span class="sd">        then 1</span>
<span class="sd">        else 0 </span>
<span class="sd">    end, 4) as qwer2,</span>
<span class="sd">    qwer3</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    substr(qwer, case when asdf = &#39;J&#39; 
        then 1
        else 0 
    end, 4) as qwer2,
    qwer3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select qwer1, substr(&#39;blabla&#39;, case when asdf = &#39;J&#39; then 1 else 0 end, 4) as qwer2, qwer3&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select qwer1,</span>
<span class="sd">    substr(&#39;blabla&#39;, case when asdf = &#39;J&#39; </span>
<span class="sd">        then 1</span>
<span class="sd">        else 0 </span>
<span class="sd">    end, 4) as qwer2,</span>
<span class="sd">    qwer3</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>    
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select qwer1,
    substr(&#39;blabla&#39;, case when asdf = &#39;J&#39; 
        then 1
        else 0 
    end, 4) as qwer2,
    qwer3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <code>SELECT DISTINCT</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select distinct asdf, qwer, qwer2,&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select distinct asdf,</span>
<span class="sd">    qwer,</span>
<span class="sd">    qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select distinct asdf,
    qwer,
    qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select distinct asdf, case when asdf = 1 then 1 else 2 end as qwerty, qwer2,&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select distinct asdf,</span>
<span class="sd">    case when asdf = 1 </span>
<span class="sd">        then 1</span>
<span class="sd">        else 2 </span>
<span class="sd">    end as qwerty,</span>
<span class="sd">    qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select distinct asdf,
    case when asdf = 1 
        then 1
        else 2 
    end as qwerty,
    qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <code>PARTITION BY</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, lead(asdf) over (partition by qwer, asdf2 order by qwer2) as qwer3, qwerty,&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    lead(asdf) over (</span>
<span class="sd">        partition by qwer,</span>
<span class="sd">            asdf2</span>
<span class="sd">        order by qwer2</span>
<span class="sd">    ) as qwer3,</span>
<span class="sd">    qwerty</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    lead(asdf) over (
        partition by qwer,
            asdf2
        order by qwer2
    ) as qwer3,
    qwerty
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, lead(asdf) over (partition by asdf, qwer order by qwer), cast(qwer as numeric), -- some comment[C]ASDF, &quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    lead(asdf) over (</span>
<span class="sd">        partition by asdf,</span>
<span class="sd">            qwer</span>
<span class="sd">        order by qwer</span>
<span class="sd">    ),</span>
<span class="sd">    cast(qwer as numeric), -- some comment</span>
<span class="sd">    ASDF</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    lead(asdf) over (
        partition by asdf,
            qwer
        order by qwer
    ),
    cast(qwer as numeric), -- some comment
    ASDF
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, lead(asdf) over (partition by asdf, qwer order by qwer, qwer2), cast(qwer as numeric), -- some comment[C]ASDF, &quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    lead(asdf) over (</span>
<span class="sd">        partition by asdf,</span>
<span class="sd">            qwer</span>
<span class="sd">        order by qwer, qwer2</span>
<span class="sd">    ),</span>
<span class="sd">    cast(qwer as numeric), -- some comment</span>
<span class="sd">    ASDF</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    lead(asdf) over (
        partition by asdf,
            qwer
        order by qwer, qwer2
    ),
    cast(qwer as numeric), -- some comment
    ASDF
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select asdf, lead(asdf, 1, 2) OVER (PARTITION BY snr, qwer ORDER BY asdf, qwer)&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    lead(asdf, 1, 2) OVER (</span>
<span class="sd">        PARTITION BY snr,</span>
<span class="sd">            qwer</span>
<span class="sd">        ORDER BY asdf, qwer)</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    lead(asdf, 1, 2) OVER (
        PARTITION BY snr,
            qwer
        ORDER BY asdf, qwer)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select DISTINCT asdf, lead(asdf) over (partition by asdf, qwer order by qwer), cast(qwer as numeric), -- some comment[C]ASDF, &quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select DISTINCT asdf,</span>
<span class="sd">    lead(asdf) over (</span>
<span class="sd">        partition by asdf,</span>
<span class="sd">            qwer</span>
<span class="sd">        order by qwer</span>
<span class="sd">    ),</span>
<span class="sd">    cast(qwer as numeric), -- some comment</span>
<span class="sd">    ASDF</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select DISTINCT asdf,
    lead(asdf) over (
        partition by asdf,
            qwer
        order by qwer
    ),
    cast(qwer as numeric), -- some comment
    ASDF
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With comments within <code>PARTITION BY</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span><span class="s2">&quot;select DISTINCT asdf, lead(asdf) over (partition by asdf, -- some comment[C]qwer order by qwer), cast(qwer as numeric), -- some comment[C]ASDF, &quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select DISTINCT asdf,</span>
<span class="sd">    lead(asdf) over (</span>
<span class="sd">        partition by asdf, -- some comment</span>
<span class="sd">            qwer</span>
<span class="sd">        order by qwer</span>
<span class="sd">    ),</span>
<span class="sd">    cast(qwer as numeric), -- some comment</span>
<span class="sd">    ASDF</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select DISTINCT asdf,
    lead(asdf) over (
        partition by asdf, -- some comment
            qwer
        order by qwer
    ),
    cast(qwer as numeric), -- some comment
    ASDF
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With too long lines</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2), substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2), substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    concat(substr(concat(&#39;)0&#39;, substr(asdf, 1, 2)), -2, 2), substr(concat(&#39;(0&#39;, substr(asdf, 3, 2)), -2, 2)) as qwer
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, case when asdf in (1231, 123123, 12312, 21412431234, 12341234123, 12341234, 12341234, 1234) then 1 else 0 end as qwer, asdf2&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    case when asdf in (1231, 123123, 12312, 21412431234, 12341234123, 12341234, 12341234, 1234) </span>
<span class="sd">        then 1</span>
<span class="sd">        else 0 </span>
<span class="sd">    end as qwer,</span>
<span class="sd">    asdf2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    case when asdf in (1231, 123123, 12312, 21412431234, 12341234123, 12341234, 12341234, 1234) 
        then 1
        else 0 
    end as qwer,
    asdf2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Long line with <code>in (...)</code> and quotes</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_select</span><span class="p">(</span>
        <span class="s2">&quot;select asdf, case when asdf in (&#39;1231&#39;, &#39;123123&#39;, &#39;12312&#39;, &#39;21412431234&#39;, &#39;12341234123&#39;, &#39;12341234&#39;, &#39;12341234&#39;, &#39;1234&#39;) then 1 else 0 end as qwer, asdf2&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    case when asdf in (&#39;1231&#39;, &#39;123123&#39;, &#39;12312&#39;, &#39;21412431234&#39;, &#39;12341234123&#39;, &#39;12341234&#39;, &#39;12341234&#39;, &#39;1234&#39;) </span>
<span class="sd">        then 1</span>
<span class="sd">        else 0 </span>
<span class="sd">    end as qwer,</span>
<span class="sd">    asdf2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    case when asdf in (&#39;1231&#39;, &#39;123123&#39;, &#39;12312&#39;, &#39;21412431234&#39;, &#39;12341234123&#39;, &#39;12341234&#39;, &#39;12341234&#39;, &#39;1234&#39;) 
        then 1
        else 0 
    end as qwer,
    asdf2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="FROM">FROM<a class="anchor-link" href="#FROM"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_from" class="doc_header"><code>format_from</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L338" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_from</code>(<strong><code>s</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Format FROM statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">format_from</span><span class="p">(</span><span class="s2">&quot;from table1 t1, /* some comment */ table2 t2, table3 as t3&quot;</span><span class="p">),</span> 
                 <span class="sd">&quot;&quot;&quot;from table1 AS t1, /* some comment */</span>
<span class="sd">    table2 AS t2,</span>
<span class="sd">    table3 as t3</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>from table1 AS t1, /* some comment */
    table2 AS t2,
    table3 as t3
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="JOIN-(LEFT/RIGHT/etc.)">JOIN (LEFT/RIGHT/etc.)<a class="anchor-link" href="#JOIN-(LEFT/RIGHT/etc.)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_join" class="doc_header"><code>format_join</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L362" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_join</code>(<strong><code>s</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Format JOIN statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_join</span><span class="p">(</span><span class="s2">&quot;join t1&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    join t1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    join t1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_join</span><span class="p">(</span><span class="s2">&quot;natural left join t1&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    natural left join t1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    natural left join t1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">split_comment_quote</span><span class="p">(</span><span class="s2">&quot;join a </span><span class="se">\n</span><span class="s2">on b and c or d and e and a between c and d&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;string&#39;: &#39;join a \non b and c or d and e and a between c and d&#39;,
  &#39;comment&#39;: False,
  &#39;quote&#39;: False}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ON">ON<a class="anchor-link" href="#ON"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_on" class="doc_header"><code>format_on</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L407" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_on</code>(<strong><code>s</code></strong>, <strong><code>max_len</code></strong>=<em><code>82</code></em>)</p>
</blockquote>
<p>Format ON statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf = b.asdf /* some comment */[C]&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on a.asdf = b.asdf /* some comment */</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf /* some comment */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf = b.asdf and a.qwer = b.qwer or a.qwer = b.qqqq&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on a.asdf = b.asdf</span>
<span class="sd">        and a.qwer = b.qwer</span>
<span class="sd">        or a.qwer = b.qqqq</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf
        and a.qwer = b.qwer
        or a.qwer = b.qqqq
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf = b.asdf and a.qwer = b.qwer OR a.qwer2 between b.qwer2 and a.qwas&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on a.asdf = b.asdf</span>
<span class="sd">        and a.qwer = b.qwer</span>
<span class="sd">        OR a.qwer2 between b.qwer2 and a.qwas</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf
        and a.qwer = b.qwer
        OR a.qwer2 between b.qwer2 and a.qwas
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf = b.asdf and a.qwer between b.qwer and d.32dfa OR a.qwer2dskjfhdsalkjfdsadalfah between b.qwedafhkdfjsakhfljdsahlfr2 and a.qwaasjdfgdsakjfdsfkas&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on a.asdf = b.asdf</span>
<span class="sd">        and a.qwer between b.qwer and d.32dfa</span>
<span class="sd">        OR a.qwer2dskjfhdsalkjfdsadalfah between b.qwedafhkdfjsakhfljdsahlfr2</span>
<span class="sd">            and a.qwaasjdfgdsakjfdsfkas</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf
        and a.qwer between b.qwer and d.32dfa
        OR a.qwer2dskjfhdsalkjfdsadalfah between b.qwedafhkdfjsakhfljdsahlfr2
            and a.qwaasjdfgdsakjfdsfkas
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With comments and bad formatted</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_on</span><span class="p">(</span><span class="s2">&quot;on a.asdf = b.asdf -- some comment[C]and a.qwer = b.qwer or /* another comment */[C]a.qwer2 = b.qwer2&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        on a.asdf = b.asdf -- some comment</span>
<span class="sd">        and a.qwer = b.qwer /* another comment */</span>
<span class="sd">        or a.qwer2 = b.qwer2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        on a.asdf = b.asdf -- some comment
        and a.qwer = b.qwer /* another comment */
        or a.qwer2 = b.qwer2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="AS-JOIN">AS JOIN<a class="anchor-link" href="#AS-JOIN"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_on" class="doc_header"><code>format_on</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L407" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_on</code>(<strong><code>s</code></strong>, <strong><code>max_len</code></strong>=<em><code>82</code></em>)</p>
</blockquote>
<p>Format ON statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="WHERE">WHERE<a class="anchor-link" href="#WHERE"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_where" class="doc_header"><code>format_where</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L441" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_where</code>(<strong><code>s</code></strong>, <strong><code>max_len</code></strong>=<em><code>82</code></em>)</p>
</blockquote>
<p>Format WHERE statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_filter_where" class="doc_header"><code>format_filter_where</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L475" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_filter_where</code>(<strong><code>s</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Format WHERE statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_where</span><span class="p">(</span>
        <span class="s2">&quot;WHERE asdf = 1 and -- and some comment[C]qwer = 1 or blabla = &#39;asdf&#39;&quot;</span>
    <span class="p">),</span> <span class="s2">&quot;&quot;&quot;WHERE asdf = 1 -- and some comment</span>
<span class="s2">    and qwer = 1</span>
<span class="s2">    or blabla = &#39;asdf&#39;&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>WHERE asdf = 1 -- and some comment
    and qwer = 1
    or blabla = &#39;asdf&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Format-all-statements">Format all statements<a class="anchor-link" href="#Format-all-statements"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_statement_line" class="doc_header"><code>format_statement_line</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L481" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_statement_line</code>(<strong><code>s</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Format statement line <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    qwer</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    qwer
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;join table1 as abc&quot;</span><span class="p">),</span>
    <span class="s2">&quot;    join table1 as abc&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    join table1 as abc
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;left join table1 as abc&quot;</span><span class="p">),</span>
    <span class="s2">&quot;    left join table1 as abc&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    left join table1 as abc
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;natural left join table1 as abc&quot;</span><span class="p">),</span>
    <span class="s2">&quot;    natural left join table1 as abc&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    natural left join table1 as abc
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statement_line</span><span class="p">(</span><span class="s2">&quot;where asdf = 1 and qwer = &#39;things&#39; and blabla = 0 or stuff = -1 AND asdf between kfj and ifffg&quot;</span><span class="p">),</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">where asdf = 1</span>
<span class="sd">    and qwer = &#39;things&#39;</span>
<span class="sd">    and blabla = 0</span>
<span class="sd">    or stuff = -1</span>
<span class="sd">    AND asdf between kfj and ifffg</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>where asdf = 1
    and qwer = &#39;things&#39;
    and blabla = 0
    or stuff = -1
    AND asdf between kfj and ifffg
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_statements" class="doc_header"><code>format_statements</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L498" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_statements</code>(<strong><code>s</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Format statements lines <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_statements</span><span class="p">(</span><span class="s2">&quot;select asdf, qwer</span><span class="se">\n</span><span class="s2">from table1&quot;</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">99</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">    qwer</span>
<span class="sd">from table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select asdf,
    qwer
from table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_join_as" class="doc_header"><code>add_join_as</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L508" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_join_as</code>(<strong><code>s</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">add_join_as</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE OR REPLACE TABLE mytable AS</span>
<span class="s2">SELECT a.asdf,</span>
<span class="s2">    b.qwer,</span>
<span class="s2">    substr(c.asdf, 1, 2) AS substr_asdf,</span>
<span class="s2">    CASE WHEN a.asdf = 1</span>
<span class="s2">        THEN &#39;b&#39;</span>
<span class="s2">        WHEN b.qwer = 2</span>
<span class="s2">        THEN &#39;c&#39;</span>
<span class="s2">        ELSE &#39;d&#39;</span>
<span class="s2">    END AS new_field,</span>
<span class="s2">    b.asdf2</span>
<span class="s2">FROM table1 AS a</span>
<span class="s2">    LEFT JOIN table2 b</span>
<span class="s2">        ON a.asdf = b.asdf</span>
<span class="s2">    INNER JOIN table3 AS c</span>
<span class="s2">        ON a.asdf = c.asdf</span>
<span class="s2">        AND a.qwer = b.qwer</span>
<span class="s2">    JOIN (</span>
<span class="s2">        SELECT t.uut from tablet</span>
<span class="s2">        WHERE t.asg = 5</span>
<span class="s2">    ) t</span>
<span class="s2">        ON a.dffg = t.dffg</span>
<span class="s2">WHERE a.asdf = 1</span>
<span class="s2">    AND b.qwer = 2</span>
<span class="s2">    AND a.asdf &lt;= 1</span>
<span class="s2">    OR b.qwer &gt;= 5</span>
<span class="s2">GROUP BY a.asdf&quot;&quot;&quot;</span><span class="p">),</span> 
<span class="sd">&quot;&quot;&quot;CREATE OR REPLACE TABLE mytable AS</span>
<span class="sd">SELECT a.asdf,</span>
<span class="sd">    b.qwer,</span>
<span class="sd">    substr(c.asdf, 1, 2) AS substr_asdf,</span>
<span class="sd">    CASE WHEN a.asdf = 1</span>
<span class="sd">        THEN &#39;b&#39;</span>
<span class="sd">        WHEN b.qwer = 2</span>
<span class="sd">        THEN &#39;c&#39;</span>
<span class="sd">        ELSE &#39;d&#39;</span>
<span class="sd">    END AS new_field,</span>
<span class="sd">    b.asdf2</span>
<span class="sd">FROM table1 AS a</span>
<span class="sd">    LEFT JOIN table2 AS b</span>
<span class="sd">        ON a.asdf = b.asdf</span>
<span class="sd">    INNER JOIN table3 AS c</span>
<span class="sd">        ON a.asdf = c.asdf</span>
<span class="sd">        AND a.qwer = b.qwer</span>
<span class="sd">    JOIN (</span>
<span class="sd">        SELECT t.uut from tablet</span>
<span class="sd">        WHERE t.asg = 5</span>
<span class="sd">    ) AS t</span>
<span class="sd">        ON a.dffg = t.dffg</span>
<span class="sd">WHERE a.asdf = 1</span>
<span class="sd">    AND b.qwer = 2</span>
<span class="sd">    AND a.asdf &lt;= 1</span>
<span class="sd">    OR b.qwer &gt;= 5</span>
<span class="sd">GROUP BY a.asdf&quot;&quot;&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE mytable AS
SELECT a.asdf,
    b.qwer,
    substr(c.asdf, 1, 2) AS substr_asdf,
    CASE WHEN a.asdf = 1
        THEN &#39;b&#39;
        WHEN b.qwer = 2
        THEN &#39;c&#39;
        ELSE &#39;d&#39;
    END AS new_field,
    b.asdf2
FROM table1 AS a
    LEFT JOIN table2 AS b
        ON a.asdf = b.asdf
    INNER JOIN table3 AS c
        ON a.asdf = c.asdf
        AND a.qwer = b.qwer
    JOIN (
        SELECT t.uut from tablet
        WHERE t.asg = 5
    ) AS t
        ON a.dffg = t.dffg
WHERE a.asdf = 1
    AND b.qwer = 2
    AND a.asdf &lt;= 1
    OR b.qwer &gt;= 5
GROUP BY a.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Format-multiline-comments">Format multiline comments<a class="anchor-link" href="#Format-multiline-comments"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_multiline_comments" class="doc_header"><code>format_multiline_comments</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L514" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_multiline_comments</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Format multiline comments by replacing multiline comment [CI] by newline and adding indentation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Add-semicolon-at-the-end-of-query">Add semicolon at the end of query<a class="anchor-link" href="#Add-semicolon-at-the-end-of-query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="add_semicolon" class="doc_header"><code>add_semicolon</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L529" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>add_semicolon</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Add a semicolon at the of query <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
<span class="n">add_semicolon</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE OR REPLACE TABLE my_table AS</span>
<span class="s2">SELECT asdf,</span>
<span class="s2">       qwer</span>
<span class="s2">FROM   table1 /* something */</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE my_table AS</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">       qwer</span>
<span class="sd">FROM   table1; /* something */</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE my_table AS
SELECT asdf,
       qwer
FROM   table1; /* something */
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
<span class="n">add_semicolon</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE OR REPLACE TABLE my_table AS</span>
<span class="s2">SELECT asdf,</span>
<span class="s2">       qwer</span>
<span class="s2">FROM   table1 -- some thing</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE my_table AS</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">       qwer</span>
<span class="sd">FROM   table1; -- some thing</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE my_table AS
SELECT asdf,
       qwer
FROM   table1; -- some thing
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
<span class="n">add_semicolon</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE OR REPLACE TABLE my_table AS</span>
<span class="s2">SELECT asdf,</span>
<span class="s2">       qwer</span>
<span class="s2">FROM   table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE my_table AS</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">       qwer</span>
<span class="sd">FROM   table1;</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE my_table AS
SELECT asdf,
       qwer
FROM   table1;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Putting-everything-together">Putting everything together<a class="anchor-link" href="#Putting-everything-together"> </a></h2><p>to format a simple query without subqueries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_simple_sql" class="doc_header"><code>format_simple_sql</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L542" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_simple_sql</code>(<strong><code>s</code></strong>, <strong><code>semicolon</code></strong>=<em><code>False</code></em>, <strong><code>max_len</code></strong>=<em><code>99</code></em>)</p>
</blockquote>
<p>Format a simple SQL query without subqueries <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_simple_sql</span><span class="p">(</span><span class="n">example_sql</span><span class="p">),</span>
    <span class="n">expected_sql</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE mytable AS -- Mytable example
/* multi line
   comment */
SELECT a.asdf,
    -- some line comment
    b.qwer, -- some comment here
    /* and here is a line comment inside select */
    substr(c.asdf, 1, 2) AS substr_asdf,
    /* some commenT
       there */
    CASE WHEN a.asdf = 1
        THEN &#39;b&#39; /* here a case comment */
        WHEN b.qwer = 2
        THEN &#39;c&#39;
        ELSE &#39;d&#39;
    END AS new_field, -- Some comment
    /* and here some inline comment */
    b.asdf2
FROM table1 AS a
    LEFT JOIN table2 AS b -- and here a comment
        ON a.asdf = b.asdf /* joiN this way */
    INNER JOIN table3 AS c
        ON a.asdf = c.asdf
        AND a.qwer = b.qwer
WHERE a.asdf = 1 -- comment this
    AND b.qwer = 2
    AND a.asdf &lt;= 1 --comment that
    OR b.qwer &gt;= 5
GROUP BY a.asdf
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_simple_sql</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">create or replace table first_table as -- my first table</span>
<span class="sd">select car_id,</span>
<span class="sd">       avg(price) as avg_price,</span>
<span class="sd">from first_view</span>
<span class="sd">group by car_id</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE first_table AS -- my first table</span>
<span class="sd">SELECT car_id,</span>
<span class="sd">    avg(price) AS avg_price</span>
<span class="sd">FROM first_view</span>
<span class="sd">GROUP BY car_id</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE first_table AS -- my first table
SELECT car_id,
    avg(price) AS avg_price
FROM first_view
GROUP BY car_id
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Queries-with-subqueries">Queries with subqueries<a class="anchor-link" href="#Queries-with-subqueries"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is how we could (badly) write a query with subqueries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_with_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf, cast(qwer as numeric), -- some comment</span>
<span class="s2">substr(qwer1, 3, 2) as substr_qwer /* some field */</span>
<span class="s2">from </span>
<span class="s2">(select asdf, qwer, /* some nice field */ from table1 where asdf = 1</span>
<span class="s2">) as a</span>
<span class="s2">left </span>
<span class="s2">join (select asdf, qwer2 from table2 where qwer2 = 1) as b</span>
<span class="s2">on a.asdf = b.asdf</span>
<span class="s2">where qwer1 &gt;= 0</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and this is the way we would like to have it nicely formatted</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_with_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf,</span>
<span class="s2">    cast(qwer AS numeric), -- some comment</span>
<span class="s2">    substr(qwer1, 3, 2) AS substr_qwer /* some field */</span>
<span class="s2">FROM (</span>
<span class="s2">    SELECT asdf,</span>
<span class="s2">        qwer /* some nice field */</span>
<span class="s2">    FROM table1</span>
<span class="s2">    WHERE asdf = 1</span>
<span class="s2">) AS a</span>
<span class="s2">    LEFT JOIN (</span>
<span class="s2">        SELECT asdf,</span>
<span class="s2">            qwer2</span>
<span class="s2">        FROM table2</span>
<span class="s2">        WHERE qwer2 = 1</span>
<span class="s2">    ) AS b</span>
<span class="s2">        ON a.asdf = b.asdf</span>
<span class="s2">WHERE qwer1 &gt;= 0</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Main-function-handling-queries-with-subqueries">Main function handling queries with subqueries<a class="anchor-link" href="#Main-function-handling-queries-with-subqueries"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_sql" class="doc_header"><code>format_sql</code><a href="https://github.com/snapADDY/ptypysql/tree/master/ptypysql/core.py#L559" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_sql</code>(<strong><code>s</code></strong>, <strong><code>semicolon</code></strong>=<em><code>False</code></em>, <strong><code>max_len</code></strong>=<em><code>99</code></em>)</p>
</blockquote>
<p>Format SQL query with subqueries <code>s</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_with_subqueries</span><span class="p">),</span>
    <span class="n">expected_with_subqueries</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
    cast(qwer AS numeric), -- some comment
    substr(qwer1, 3, 2) AS substr_qwer /* some field */
FROM (
    SELECT asdf,
        qwer /* some nice field */
    FROM table1
    WHERE asdf = 1
) AS a
    LEFT JOIN (
        SELECT asdf,
            qwer2
        FROM table2
        WHERE qwer2 = 1
    ) AS b
        ON a.asdf = b.asdf
WHERE qwer1 &gt;= 0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It even works with simple queries without subqueries, therefore generalizing the <code>format_simple_sql()</code> function</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># still have problem; cannot handle sql with too many comment</span>
<span class="c1"># assert_and_print(</span>
<span class="c1">#     format_sql(example_sql),</span>
<span class="c1">#     expected_sql</span>
<span class="c1"># )</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Nested-subqueries">Nested subqueries<a class="anchor-link" href="#Nested-subqueries"> </a></h2><p>The function is also robust against nested subqueries</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_nested_subqueries</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf, qwer</span>
<span class="s2">from (select a.asdf,  lead(a.substr_qwer) over (partition by a.asdf, asdf2 order by qwer) as lead_qwerty</span>
<span class="s2">    from (select asdf, substr(qwer, 3, 2) as substr_qwer from table2) as a</span>
<span class="s2">        inner join (select asdf, qwer from table3) as b</span>
<span class="s2">            on a.qwer = b.qwer</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_nested</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT asdf,</span>
<span class="s2">    qwer</span>
<span class="s2">FROM (</span>
<span class="s2">    SELECT a.asdf,</span>
<span class="s2">        lead(a.substr_qwer) OVER (</span>
<span class="s2">            PARTITION BY a.asdf,</span>
<span class="s2">                asdf2</span>
<span class="s2">            ORDER BY qwer</span>
<span class="s2">        ) AS lead_qwerty</span>
<span class="s2">    FROM (</span>
<span class="s2">        SELECT asdf,</span>
<span class="s2">            substr(qwer, 3, 2) AS substr_qwer</span>
<span class="s2">        FROM table2</span>
<span class="s2">    ) AS a</span>
<span class="s2">        INNER JOIN (</span>
<span class="s2">            SELECT asdf,</span>
<span class="s2">                qwer</span>
<span class="s2">            FROM table3</span>
<span class="s2">        ) AS b</span>
<span class="s2">            ON a.qwer = b.qwer</span>
<span class="s2">)&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_nested_subqueries</span><span class="p">),</span>
    <span class="n">expected_nested</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
    qwer
FROM (
    SELECT a.asdf,
        lead(a.substr_qwer) OVER (
            PARTITION BY a.asdf,
                asdf2
            ORDER BY qwer
        ) AS lead_qwerty
    FROM (
        SELECT asdf,
            substr(qwer, 3, 2) AS substr_qwer
        FROM table2
    ) AS a
        INNER JOIN (
            SELECT asdf,
                qwer
            FROM table3
        ) AS b
            ON a.qwer = b.qwer
)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="With-SELECT-DISTINCT">With SELECT DISTINCT<a class="anchor-link" href="#With-SELECT-DISTINCT"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf, qwer from (select distinct asdf, qwer from table1)</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">    qwer</span>
<span class="sd">FROM (</span>
<span class="sd">    SELECT DISTINCT asdf,</span>
<span class="sd">        qwer</span>
<span class="sd">    FROM table1</span>
<span class="sd">)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
    qwer
FROM (
    SELECT DISTINCT asdf,
        qwer
    FROM table1
)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="More-convoluted-nested-subquery">More convoluted nested subquery<a class="anchor-link" href="#More-convoluted-nested-subquery"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_convoluted</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select asdf</span>
<span class="s2">from (</span>
<span class="s2">    select asdf, qwer, /* some comment */</span>
<span class="s2">    from (select a.asdf, b.qwer, --some comment</span>
<span class="s2">          from (select asdf </span>
<span class="s2">                from table1) as a </span>
<span class="s2">            right join (select qwer </span>
<span class="s2">                        from table2) as b</span>
<span class="s2">                on a.asdf = b.asdf)</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_convoluted</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT asdf</span>
<span class="s2">FROM (</span>
<span class="s2">    SELECT asdf,</span>
<span class="s2">        qwer /* some comment */</span>
<span class="s2">    FROM (</span>
<span class="s2">        SELECT a.asdf,</span>
<span class="s2">            b.qwer --some comment</span>
<span class="s2">        FROM (</span>
<span class="s2">            SELECT asdf</span>
<span class="s2">            FROM table1</span>
<span class="s2">        ) AS a</span>
<span class="s2">            RIGHT JOIN (</span>
<span class="s2">                SELECT qwer</span>
<span class="s2">                FROM table2</span>
<span class="s2">            ) AS b</span>
<span class="s2">                ON a.asdf = b.asdf</span>
<span class="s2">    )</span>
<span class="s2">)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span><span class="n">example_convoluted</span><span class="p">),</span>
    <span class="n">expected_convoluted</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf
FROM (
    SELECT asdf,
        qwer /* some comment */
    FROM (
        SELECT a.asdf,
            b.qwer --some comment
        FROM (
            SELECT asdf
            FROM table1
        ) AS a
            RIGHT JOIN (
                SELECT qwer
                FROM table2
            ) AS b
                ON a.asdf = b.asdf
    )
)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
    <span class="n">format_sql</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">select asdf,</span>
<span class="sd">qwer</span>
<span class="sd">from table1 union select qwer,</span>
<span class="sd">asdf, asdf2 from table3</span>
<span class="sd">where asdf2 &gt;=2</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">    qwer</span>
<span class="sd">FROM table1</span>
<span class="sd">UNION</span>
<span class="sd">SELECT qwer,</span>
<span class="sd">    asdf,</span>
<span class="sd">    asdf2</span>
<span class="sd">FROM table3</span>
<span class="sd">WHERE asdf2 &gt;= 2</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SELECT asdf,
    qwer
FROM table1
UNION
SELECT qwer,
    asdf,
    asdf2
FROM table3
WHERE asdf2 &gt;= 2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Partition By with newline</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
<span class="n">format_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace table asdf as</span>
<span class="s2">select asdf, qwer over (</span>
<span class="s2">partition by asdf, qwer order by qwerty</span>
<span class="s2">)</span>
<span class="s2">from table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE asdf AS</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">    qwer OVER (</span>
<span class="sd">        PARTITION BY asdf,</span>
<span class="sd">            qwer</span>
<span class="sd">        ORDER BY qwerty)</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE asdf AS
SELECT asdf,
    qwer OVER (
        PARTITION BY asdf,
            qwer
        ORDER BY qwerty)
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Too long lines query</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span>
<span class="n">format_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create or replace table asdf as</span>
<span class="s2">select asdf, </span>
<span class="s2">case when asdf in (123412341234, 12341234123412, 123412341234, 512351235132, 123412341, 1234) then 1 else 0 end as qwerty,</span>
<span class="s2">qwer over (</span>
<span class="s2">partition by asdf, qwer order by qwerty</span>
<span class="s2">)</span>
<span class="s2">from table1</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">),</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CREATE OR REPLACE TABLE asdf AS</span>
<span class="sd">SELECT asdf,</span>
<span class="sd">    CASE WHEN asdf IN (123412341234, 12341234123412, 123412341234, 512351235132, 123412341, 1234)</span>
<span class="sd">        THEN 1</span>
<span class="sd">        ELSE 0</span>
<span class="sd">    END AS qwerty,</span>
<span class="sd">    qwer OVER (</span>
<span class="sd">        PARTITION BY asdf,</span>
<span class="sd">            qwer</span>
<span class="sd">        ORDER BY qwerty)</span>
<span class="sd">FROM table1</span>
<span class="sd">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CREATE OR REPLACE TABLE asdf AS
SELECT asdf,
    CASE WHEN asdf IN (123412341234, 12341234123412, 123412341234, 512351235132, 123412341, 1234)
        THEN 1
        ELSE 0
    END AS qwerty,
    qwer OVER (
        PARTITION BY asdf,
            qwer
        ORDER BY qwerty)
FROM table1
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">testcase</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;WITH days AS (</span>
<span class="s2">    SELECT generate_series(:start_date, :end_date, &#39;1 day&#39;::interval) AS day</span>
<span class="s2">)</span>
<span class="s2">SELECT days.day,</span>
<span class="s2">       count(*) FILTER (</span>
<span class="s2">           WHERE  job.state = &#39;completed&#39;</span>
<span class="s2">       ) AS completed_jobs_count,</span>
<span class="s2">       count(*) FILTER (</span>
<span class="s2">           WHERE  job.state = &#39;failed&#39;</span>
<span class="s2">       ) AS failed_jobs_count,</span>
<span class="s2">       coalesce(sum((job.return_value -&gt;&gt; &#39;successRows&#39;)::int) FILTER (</span>
<span class="s2">           WHERE  job.state = &#39;completed&#39;</span>
<span class="s2">       ),</span>
<span class="s2">                0) AS completed_rows_count,</span>
<span class="s2">       coalesce(sum((job.return_value -&gt;&gt; &#39;totalRows&#39;)::int - (job.return_value -&gt;&gt; &#39;successRows&#39;)::int) FILTER (</span>
<span class="s2">           WHERE  job.state = &#39;completed&#39;</span>
<span class="s2">       ),</span>
<span class="s2">                0) AS failed_rows_count</span>
<span class="s2">FROM   days</span>
<span class="s2">LEFT</span>
<span class="s2">JOIN   (</span>
<span class="s2">    SELECT state,</span>
<span class="s2">           return_value,</span>
<span class="s2">           created_at</span>
<span class="s2">    FROM   analytics_job</span>
<span class="s2">    WHERE  type = &#39;data_enrichment&#39;</span>
<span class="s2">       AND data -&gt;&gt; &#39;strategy&#39; = &#39;EMAIL_FINDER&#39;</span>
<span class="s2">       AND created_at BETWEEN :start_date</span>
<span class="s2">                          AND (:end_date)::date + &#39;23:59:59.999999&#39;::time</span>
<span class="s2">) AS job</span>
<span class="s2">    ON date_trunc(&#39;day&#39;, job.created_at) = days.day</span>
<span class="s2">GROUP BY 1</span>
<span class="s2">ORDER BY days.day DESC;&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">expected_testcase</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;WITH days AS (</span>
<span class="s2">    SELECT generate_series(:start_date, :end_date, &#39;1 day&#39;::interval) AS day</span>
<span class="s2">)</span>
<span class="s2">SELECT days.day,</span>
<span class="s2">    count(*) FILTER (</span>
<span class="s2">        WHERE job.state = &#39;completed&#39;</span>
<span class="s2">    ) AS completed_jobs_count,</span>
<span class="s2">    count(*) FILTER (</span>
<span class="s2">        WHERE job.state = &#39;failed&#39;</span>
<span class="s2">    ) AS failed_jobs_count,</span>
<span class="s2">    coalesce(sum((job.return_value -&gt;&gt; &#39;successRows&#39;)::int) FILTER (</span>
<span class="s2">        WHERE job.state = &#39;completed&#39;</span>
<span class="s2">    ), 0) AS completed_rows_count,</span>
<span class="s2">    coalesce(</span>
<span class="s2">        sum(</span>
<span class="s2">            (job.return_value -&gt;&gt; &#39;totalRows&#39;)::int - (job.return_value -&gt;&gt; &#39;successRows&#39;)::int</span>
<span class="s2">        ) FILTER (</span>
<span class="s2">            WHERE job.state = &#39;completed&#39;</span>
<span class="s2">        ),</span>
<span class="s2">        0</span>
<span class="s2">    ) AS failed_rows_count</span>
<span class="s2">FROM days</span>
<span class="s2">    LEFT JOIN (</span>
<span class="s2">        SELECT state,</span>
<span class="s2">            return_value,</span>
<span class="s2">            created_at</span>
<span class="s2">        FROM analytics_job</span>
<span class="s2">        WHERE type = &#39;data_enrichment&#39;</span>
<span class="s2">            AND data -&gt;&gt; &#39;strategy&#39; = &#39;EMAIL_FINDER&#39;</span>
<span class="s2">            AND created_at BETWEEN :start_date AND (:end_date)::date + &#39;23:59:59.999999&#39;::time</span>
<span class="s2">    ) AS job</span>
<span class="s2">        ON date_trunc(&#39;day&#39;, job.created_at) = days.day</span>
<span class="s2">GROUP BY 1</span>
<span class="s2">ORDER BY days.day DESC;&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">assert_and_print</span><span class="p">(</span><span class="n">format_sql</span><span class="p">(</span><span class="n">testcase</span><span class="p">),</span> <span class="n">expected_testcase</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">format_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot; WITH days AS (</span>
<span class="s2">                SELECT generate_series(:start_date, :end_date, &#39;1 day&#39;::interval) AS day</span>
<span class="s2">            )</span>
<span class="s2">            SELECT days.day,</span>
<span class="s2">                COUNT(*) FILTER (WHERE job.state = &#39;completed&#39;) AS completed_jobs_count,</span>
<span class="s2">                COUNT(*) FILTER (WHERE job.state = &#39;failed&#39;) AS failed_jobs_count,</span>
<span class="s2">                COALESCE(SUM((job.return_value-&gt;&gt;&#39;successRows&#39;)::int)</span>
<span class="s2">                    FILTER (WHERE job.state = &#39;completed&#39;), 0) AS completed_rows_count,</span>
<span class="s2">                COALESCE(SUM((job.return_value-&gt;&gt;&#39;totalRows&#39;)::int - (job.return_value-&gt;&gt;&#39;successRows&#39;)::int)</span>
<span class="s2">                    FILTER (WHERE job.state = &#39;completed&#39;), 0) AS failed_rows_count</span>
<span class="s2">            FROM days</span>
<span class="s2">            LEFT JOIN (</span>
<span class="s2">                SELECT state, return_value, created_at</span>
<span class="s2">                FROM analytics_job</span>
<span class="s2">                WHERE type = &#39;data_enrichment&#39;</span>
<span class="s2">                    AND data-&gt;&gt;&#39;strategy&#39; = &#39;EMAIL_FINDER&#39;</span>
<span class="s2">                    AND created_at BETWEEN :start_date</span>
<span class="s2">                        AND (:end_date)::date + &#39;23:59:59.999999&#39;::time</span>
<span class="s2">            ) AS job ON date_trunc(&#39;day&#39;, job.created_at) = days.day</span>
<span class="s2">            GROUP BY 1</span>
<span class="s2">            ORDER BY days.day&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>WITH days AS (
    SELECT generate_series(:start_date, :end_date, &#39;1 day&#39;::interval) AS day
)
SELECT days.day,
    count(*) FILTER (
        WHERE job.state = &#39;completed&#39;
    ) AS completed_jobs_count,
    count(*) FILTER (
        WHERE job.state = &#39;failed&#39;
    ) AS failed_jobs_count,
    coalesce(sum((job.return_value -&gt;&gt; &#39;successRows&#39;)::int) FILTER (
        WHERE job.state = &#39;completed&#39;
    ), 0) AS completed_rows_count,
    coalesce(
        sum(
            (job.return_value -&gt;&gt; &#39;totalRows&#39;)::int - (job.return_value -&gt;&gt; &#39;successRows&#39;)::int
        ) FILTER (
            WHERE job.state = &#39;completed&#39;
        ),
        0
    ) AS failed_rows_count
FROM days
    LEFT JOIN (
        SELECT state,
            return_value,
            created_at
        FROM analytics_job
        WHERE type = &#39;data_enrichment&#39;
            AND data -&gt;&gt; &#39;strategy&#39; = &#39;EMAIL_FINDER&#39;
            AND created_at BETWEEN :start_date AND (:end_date)::date + &#39;23:59:59.999999&#39;::time
    ) AS job
        ON date_trunc(&#39;day&#39;, job.created_at) = days.day
GROUP BY 1
ORDER BY days.day
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>


